library(tidyverse)
library(h2o)
library(doParallel)
library(here)
library(skimr)
library(naniar)
library(recipes)
install.packages('h2o')
library(h2o)
install.packages("doParallel")
library(doParallel)
setwd("D:/2020Äêsummer/visualization/10")
NESdta <- read_csv("anes_2016.csv.txt")
NES_new <- NESdta %>%
  dplyr::select(pid3, starts_with("ft")) %>%
  mutate(democrat = ifelse(pid3 == 1, 1, 0),
         fttrump = replace(fttrump, fttrump > 100, NA),
         ftobama = replace(ftobama, ftobama > 100, NA),
         ftblack = replace(ftblack, ftblack > 100, NA),
         ftwhite = replace(ftwhite, ftwhite > 100, NA),
         fthisp = replace(fthisp, fthisp > 100, NA),
         ftgay = replace(ftgay, ftgay > 100, NA),
         ftjeb = replace(ftjeb, ftjeb > 100, NA),
         ftcarson = replace(ftcarson, ftcarson > 100, NA),
         fthrc = replace(fthrc, fthrc > 100, NA),
         ftrubio = replace(ftrubio, ftrubio > 100, NA),
         ftcruz = replace(ftcruz, ftcruz > 100, NA),
         ftsanders = replace(ftsanders, ftsanders > 100, NA),
         ftfiorina = replace(ftfiorina, ftfiorina > 100, NA),
         ftpolice = replace(ftpolice, ftpolice > 100, NA),
         ftfem = replace(ftfem, ftfem > 100, NA),
         fttrans = replace(fttrans, fttrans > 100, NA),
         ftmuslim = replace(ftmuslim, ftmuslim > 100, NA),
         ftsci = replace(ftsci, ftsci > 100, NA))
# drop pid3 for fitting in a bit
NES_new <- NES_new %>% 
  dplyr::select(-pid3) %>% 
  glimpse()
NES_new %>%   
  skim() 
# inspect
NES_new %>%
  gg_miss_upset()
# impute
anes_recipe <- recipe(democrat ~ ., 
                      data = NES_new) %>%
  step_knnimpute(all_predictors()) 
anes_imputed <- prep(anes_recipe) %>% 
  juice()
# check to make sure
anes_imputed %>%   
  skim() 
theme_set(theme_minimal())
# light EDA
ggplot(anes_imputed, aes(ftobama, fill = factor(democrat))) + 
  geom_boxplot(alpha = 0.5) + 
  labs(fill = "Democrat")
ggplot(anes_imputed, aes(fttrump, fill = factor(democrat))) + 
  geom_boxplot(alpha = 0.5) + 
  labs(fill = "Democrat")
ggplot(anes_imputed, aes(ftjeb, fill = factor(democrat))) + 
  geom_boxplot(alpha = 0.5) + 
  labs(fill = "Democrat")
ggplot(anes_imputed, aes(fthrc, fill = factor(democrat))) + 
  geom_boxplot(alpha = 0.5) + 
  labs(fill = "Democrat")
ggplot(anes_imputed, aes(ftsanders, fill = factor(democrat))) +
  geom_boxplot(alpha = 0.5) + 
  labs(fill = "Democrat")
# can also view the histograms for both parties 
ggplot(anes_imputed, aes(x = ftobama)) +
  geom_histogram(color = "dodger blue", 
                 fill = "dodger blue",
                 alpha = 0.5,
                 bins = 30) +
  facet_wrap( ~ democrat)
ggplot(anes_imputed, aes(x = fttrump)) +
  geom_histogram(color = "dodger blue", 
                 fill = "dodger blue", 
                 alpha = 0.5, 
                 bins = 30) +
  facet_wrap( ~ democrat)
anes_imputed %>%
  ggplot(aes(x = democrat)) +
  geom_bar(color = "dark red", 
           fill = "dark red", 
           alpha = 0.5) +
  labs(title = "Party Distribution",
       x = "Democrat",
       y = "Count")
set.seed(1234)
anes_imputed$democrat <- factor(anes_imputed$democrat)
# initializing the H2O cluster/session; set stuff up
my_h2o <- h2o.init()
cores <- detectCores() - 1 
cluster <- makeCluster(cores, setup_timeout = 0.5)
registerDoParallel(cluster) 
anes_h2o <- anes_imputed %>% 
cluster <- makeCluster(cores, setup_timeout = 0.5)
q()
